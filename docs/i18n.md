# Guia de Internacionaliza√ß√£o (i18n)

Este documento descreve as pr√°ticas e padr√µes para internacionaliza√ß√£o do sistema.

## üìã √çndice

1. [Vis√£o Geral](#vis√£o-geral)
2. [Estrutura de Arquivos](#estrutura-de-arquivos)
3. [Padr√£o de Nomenclatura](#padr√£o-de-nomenclatura)
4. [Como Usar](#como-usar)
5. [Interpola√ß√£o](#interpola√ß√£o)
6. [Pluraliza√ß√£o](#pluraliza√ß√£o)
7. [Formata√ß√£o](#formata√ß√£o)
8. [Checklist para PRs](#checklist-para-prs)
9. [Ferramentas de Auditoria](#ferramentas-de-auditoria)

---

## Vis√£o Geral

O sistema utiliza [i18next](https://www.i18next.com/) com React para gerenciar tradu√ß√µes em tr√™s idiomas:

- **pt-BR** (Portugu√™s - Brasil) - Idioma padr√£o/fallback
- **en** (English)
- **es** (Espa√±ol)

### Princ√≠pios

1. **Nenhuma string hardcoded**: Todo texto vis√≠vel ao usu√°rio deve usar `t()`
2. **Consist√™ncia**: Mesma chave em todos os idiomas
3. **Contexto**: Chaves devem ser auto-explicativas

---

## Estrutura de Arquivos

```
src/i18n/
‚îú‚îÄ‚îÄ index.ts              # Configura√ß√£o principal do i18next
‚îú‚îÄ‚îÄ locales/
‚îÇ   ‚îú‚îÄ‚îÄ pt-BR.json        # Tradu√ß√µes em portugu√™s (refer√™ncia)
‚îÇ   ‚îú‚îÄ‚îÄ en.json           # Tradu√ß√µes em ingl√™s
‚îÇ   ‚îî‚îÄ‚îÄ es.json           # Tradu√ß√µes em espanhol
‚îú‚îÄ‚îÄ translateMessage.ts   # Utilit√°rios de tradu√ß√£o
‚îî‚îÄ‚îÄ useLocale.ts          # Hook para gerenciar locale
```

---

## Padr√£o de Nomenclatura

### Formato

```
{p√°gina}.{se√ß√£o}.{elemento}
```

### Namespaces Definidos

| Namespace | Descri√ß√£o |
|-----------|-----------|
| `common` | Textos reutiliz√°veis (bot√µes, a√ß√µes, labels gen√©ricos) |
| `auth` | Autentica√ß√£o (login, signup, valida√ß√£o) |
| `dashboard` | P√°gina inicial/dashboard |
| `transactions` | Gerenciamento de transa√ß√µes |
| `budget` | Or√ßamento mensal |
| `accounts` | Contas banc√°rias |
| `categories` | Categorias e subcategorias |
| `members` | Membros da fam√≠lia |
| `notifications` | Sistema de notifica√ß√µes |
| `projection` | Proje√ß√µes e simula√ß√µes |
| `filters` | Filtros e ordena√ß√£o |
| `settings` | Configura√ß√µes |
| `validation` | Mensagens de valida√ß√£o |
| `errors` | Mensagens de erro |
| `empty` | Estados vazios |

### Exemplos

```json
{
  "transactions": {
    "title": "Transa√ß√µes",
    "description": "Gerencie suas transa√ß√µes",
    "actions": {
      "confirm": "Confirmar transa√ß√£o",
      "cancel": "Cancelar transa√ß√£o"
    },
    "messages": {
      "created": "Transa√ß√£o criada com sucesso",
      "deleted": "Transa√ß√£o exclu√≠da"
    },
    "empty": {
      "title": "Nenhuma transa√ß√£o",
      "description": "Comece adicionando uma transa√ß√£o"
    }
  }
}
```

---

## Como Usar

### Uso B√°sico

```tsx
import { useTranslation } from 'react-i18next';

function MyComponent() {
  const { t } = useTranslation();
  
  return (
    <h1>{t('transactions.title')}</h1>
  );
}
```

### Com Componentes

```tsx
import { useTranslation } from 'react-i18next';

function TransactionForm() {
  const { t } = useTranslation();
  
  return (
    <form>
      <label>{t('transactions.amount')}</label>
      <Button>{t('common.save')}</Button>
    </form>
  );
}
```

---

## Interpola√ß√£o

### Vari√°veis Simples

```json
{
  "dashboard": {
    "description": "Vis√£o geral das finan√ßas de {{month}}"
  }
}
```

```tsx
t('dashboard.description', { month: 'Janeiro' })
// ‚Üí "Vis√£o geral das finan√ßas de Janeiro"
```

### M√∫ltiplas Vari√°veis

```json
{
  "transactions": {
    "installments": {
      "number": "Parcela {{current}} de {{total}}"
    }
  }
}
```

```tsx
t('transactions.installments.number', { current: 3, total: 12 })
// ‚Üí "Parcela 3 de 12"
```

### Valores Monet√°rios

Use a fun√ß√£o `formatCurrencyForLocale` para moedas:

```tsx
import { formatCurrencyForLocale } from '@/i18n/translateMessage';

const formattedAmount = formatCurrencyForLocale(1500.50);
// pt-BR: "R$ 1.500,50"
// en: "$1,500.50"
// es: "‚Ç¨1.500,50"
```

---

## Pluraliza√ß√£o

O i18next suporta pluraliza√ß√£o autom√°tica com sufixos `_one` e `_other`:

```json
{
  "common": {
    "days_one": "{{count}} dia",
    "days_other": "{{count}} dias"
  }
}
```

```tsx
t('common.days', { count: 1 })  // ‚Üí "1 dia"
t('common.days', { count: 5 })  // ‚Üí "5 dias"
```

### Regras por Idioma

- **pt-BR/es**: `_one` (1), `_other` (0, 2+)
- **en**: `_one` (1), `_other` (0, 2+)

---

## Formata√ß√£o

### Datas

```tsx
import { format } from 'date-fns';
import { ptBR, enUS, es } from 'date-fns/locale';
import { LOCALE_CONFIG } from '@/i18n';

// Use o dateFormat do locale atual
const dateLocale = LOCALE_CONFIG[currentLocale].dateLocale;
```

### N√∫meros

```tsx
const { numberFormat } = LOCALE_CONFIG[currentLocale];
new Intl.NumberFormat(numberFormat).format(1234.56);
```

---

## Checklist para PRs

Antes de abrir um PR, verifique:

- [ ] **Nenhuma string hardcoded** em componentes UI
- [ ] **Todas as chaves existem** em pt-BR.json, en.json e es.json
- [ ] **Namespaces corretos** seguindo o padr√£o `p√°gina.se√ß√£o.elemento`
- [ ] **Interpola√ß√£o correta** com `{{vari√°vel}}`
- [ ] **Pluraliza√ß√£o** onde necess√°rio com `_one`/`_other`
- [ ] **Tradu√ß√µes de qualidade** (n√£o apenas tradu√ß√µes autom√°ticas)
- [ ] **Executou auditoria** com `npm run i18n:audit`
- [ ] **Teste E2E passou** para i18n anti-regress√£o

### Exce√ß√µes Permitidas

N√£o √© necess√°rio traduzir:

1. **Dados do usu√°rio** (nomes, descri√ß√µes cadastradas)
2. **Nomes de categoria/subcategoria** (cadastrados pelo usu√°rio)
3. **√çcones e s√≠mbolos**
4. **Labels t√©cnicos** (IDs, c√≥digos)

---

## Ferramentas de Auditoria

### Scripts Dispon√≠veis

| Comando | Descri√ß√£o |
|---------|-----------|
| `npx tsx scripts/i18n-audit.ts` | Verifica chaves faltando/n√£o usadas |
| `npx tsx scripts/check-hardcoded-strings.ts` | Detecta strings hardcoded em componentes |
| `npx tsx scripts/pre-publish-check.ts` | **Verifica√ß√£o pr√©-publica√ß√£o (bloqueia em falha)** |
| `npx tsx scripts/pre-publish-check.ts --e2e` | Verifica√ß√£o + testes E2E |

### üö® Verifica√ß√£o Pr√©-Publica√ß√£o

**OBRIGAT√ìRIO** antes de publicar:

```bash
npx tsx scripts/pre-publish-check.ts
```

Este script verifica:
1. ‚úÖ **i18n audit** - Sem chaves faltando ou inconsistentes
2. ‚úÖ **Hardcoded strings** - Sem strings n√£o traduzidas na UI
3. ‚úÖ **Visibilidade de chaves** - Nenhuma key raw renderizada
4. ‚úÖ **Paridade de tradu√ß√µes** - Todos os locales t√™m as mesmas chaves

**‚õî A publica√ß√£o √© BLOQUEADA se qualquer verifica√ß√£o falhar.**

Para verifica√ß√£o completa incluindo testes E2E:
```bash
npx tsx scripts/pre-publish-check.ts --e2e
```

### Script de Auditoria

```bash
npx tsx scripts/i18n-audit.ts
```

Verifica:
- Chaves usadas no c√≥digo mas faltando nos JSONs
- Chaves √≥rf√£s (definidas mas n√£o usadas)
- Inconsist√™ncias entre arquivos de idioma

### Detec√ß√£o de Strings Hardcoded

```bash
npx tsx scripts/check-hardcoded-strings.ts
```

Varre componentes buscando textos que deveriam usar `t()`.

### Teste E2E Anti-Regress√£o

```bash
npx playwright test tests/e2e/formsI18nRegression.spec.ts
```

Navega por todas as p√°ginas em todos os idiomas verificando:
- Aus√™ncia de chaves de tradu√ß√£o vis√≠veis (ex: `namespace.key`)
- Aus√™ncia de indicadores de erro (undefined, null, missingKey)

---

## Pseudolocale (Desenvolvimento)

Em ambiente de desenvolvimento, chaves ausentes s√£o exibidas com prefixo `‚ö†Ô∏è`:

```
‚ö†Ô∏è transactions.newKey
```

Isso ajuda a identificar visualmente tradu√ß√µes faltando.

---

## Adicionando Novas Tradu√ß√µes

### Passo a Passo

1. **Adicione a chave em pt-BR.json** (refer√™ncia)
2. **Copie para en.json e es.json** com tradu√ß√µes corretas
3. **Use a chave no c√≥digo** com `t('namespace.key')`
4. **Execute a auditoria** para verificar consist√™ncia
5. **Teste manualmente** alternando idiomas

### Exemplo Completo

```json
// pt-BR.json
{
  "transactions": {
    "newFeature": {
      "title": "Nova Funcionalidade",
      "description": "Descri√ß√£o da funcionalidade"
    }
  }
}

// en.json
{
  "transactions": {
    "newFeature": {
      "title": "New Feature",
      "description": "Feature description"
    }
  }
}

// es.json
{
  "transactions": {
    "newFeature": {
      "title": "Nueva Funcionalidad",
      "description": "Descripci√≥n de la funcionalidad"
    }
  }
}
```

```tsx
// No componente
const { t } = useTranslation();

return (
  <div>
    <h1>{t('transactions.newFeature.title')}</h1>
    <p>{t('transactions.newFeature.description')}</p>
  </div>
);
```

---

## Suporte

- Documenta√ß√£o i18next: https://www.i18next.com/
- React-i18next: https://react.i18next.com/
